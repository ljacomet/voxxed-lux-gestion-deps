<!DOCTYPE html><html lang="en"><head><meta charset="utf-8" /><title>: Practical dependency management with Gradle 5</title><meta content="yes" name="apple-mobile-web-app-capable" /><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style" /><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport" /><link href="reveal.js/css/reveal.css" rel="stylesheet" /><link rel="stylesheet" href="reveal.js/css/theme/gradle.css" id="theme" /><!--This CSS is generated by the Asciidoctor-Reveal.js converter to further integrate AsciiDoc's existing semantic with Reveal.js--><style type="text/css">.reveal div.right {
  float: right;
}

/* callouts */
.conum[data-value] {display:inline-block;color:#fff!important;background-color:rgba(50,150,50,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}</style><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" /><link href="reveal.js/lib/css/zenburn.css" rel="stylesheet" /><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? "reveal.js/css/print/pdf.css" : "reveal.js/css/print/paper.css";
document.getElementsByTagName( 'head' )[0].appendChild( link );</script><!--[if lt IE 9]><script src="reveal.js/lib/js/html5shiv.js"></script><![endif]-->
<link rel="stylesheet" type="text/css" href="reveal.js/css/theme/asciinema-player.css" />
<link rel="stylesheet" type="text/css" href="reveal.js/css/theme/asciinema-theme-gradle.css" />
<link rel="stylesheet" type="text/css" href="reveal.js/css/theme/github-gist.css" />
<script src="reveal.js/css/theme/asciinema-player.js"></script></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title" data-transition="zoom" data-transition-speed="fast" data-background-image="./images/title.png"><h1></h1><h2>Practical dependency management with Gradle 5</h2><div class="preamble"><div class="paragraph"><p>Louis Jacomet (@ljacomet) - Gradle Inc.</p></div></div></section>
<section><section id="who-am-i"><h2>Who am I?</h2></section><section id="louis"><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">speaker {
    name 'Louis Jacomet'
    company 'Gradle Inc.'

    previously 'Terracotta / Ehcache',
              'Freelance consultant',

    outputs Stream.of(bugs),

    twitter '@ljacomet',
    github 'ljacomet',

    extraDescription '''Did not figure out fully
                        how to stay out of management?!?'''
}</code></pre></section></section>
<section><section id="what-is-gradle" data-background-color="#01303a"><h2>What is Gradle?</h2></section><section id="gradle-s-purpose"><h2>Gradle&#8217;s purpose</h2><div class="paragraph"><p>Gradle is a build and automation tool.</p></div>
<div class="ulist"><ul><li class="fragment"><p>JVM based</p></li><li class="fragment"><p>Implemented in Java</p></li><li class="fragment"><p>100% Free Open Source - Apache Standard License 2.0</p></li></ul></div></section><section id="agnostic-build-system"><h2>Agnostic Build System</h2><div class="ulist"><ul><li><p>Java ecosystem</p><div class="ulist"><ul><li><p>Groovy, Kotlin, Scala, &#8230;&#8203;</p></li></ul></div></li><li><p>Native ecosystem</p><div class="ulist"><ul><li><p>C, C++, Swift, &#8230;&#8203;</p></li></ul></div></li><li><p>Android</p></li><li><p>Misc</p><div class="ulist"><ul><li><p>Go, Asciidoctor, &#8230;&#8203;</p></li></ul></div></li></ul></div></section><section id="gradle-in-figures"><h2>Gradle in figures</h2><div class="ulist"><ul><li class="fragment"><p>10.0M+ downloads / month</p></li><li class="fragment"><p><a href="https://techcrunch.com/2017/04/07/tracking-the-explosive-growth-of-open-source-software/">#17 OSS projects worldwide</a></p></li><li class="fragment"><p>35+ Gradle Engineers</p></li><li class="fragment"><p>300K builds/week @LinkedIn</p></li></ul></div></section><section id="gradle-inc"><h2>Gradle Inc.</h2><div class="paragraph"><p>The company behind Gradle.</p></div>
<div class="ulist"><ul><li class="fragment"><p>Build Happiness</p></li><li class="fragment"><p>Employs full time engineers</p></li><li class="fragment"><p>Providing Gradle Build Scans and Gradle Enterprise</p></li><li class="fragment"><p>Trainings and webinars: online and free</p></li></ul></div></section><section id="gradle-enterprise"><h2>Gradle Enterprise</h2><div class="imageblock" style=""><img src="./images/gradle-enterprise.png" alt="gradle enterprise" width="80%" height="80%" /></div></section><section id="gradle-is-hiring"><h2>Gradle is hiring!</h2><div class="ulist"><ul><li><p>Fully distributed development team</p></li><li><p>Exciting project used by millions</p></li><li><p>Build Tool team and Gradle Enterprise positions</p></li></ul></div>
<div class="paragraph"><p>If anything you hear from now on sounds like a great problem to solve,</p></div>
<div class="paragraph"><p>Talk to us!</p></div>
<div class="ulist"><ul><li><p><a href="https://gradle.com/careers/" class="bare">https://gradle.com/careers/</a></p></li></ul></div></section></section>
<section><section id="why-dependency-management" data-background-color="#01303a"><h2>Why dependency management?</h2></section><section id="a-long-time-ago"><h2>A long time ago &#8230;&#8203;</h2><pre class="highlight listingblock"><code data-noescape="" class="bash language-bash">&gt; javac -d out *.java
&gt; cd out/
&gt; jar cf ../../lib/project1.jar *.class
&gt; cd ../../project2
&gt; javac -cp ../lib/project1.jar -d out *.class</code></pre></section><section id="then-came-tools"><h2>Then came tools</h2><div class="ulist"><ul><li><p>Helped you build and package</p></li><li><p>Did not handle dependencies</p><div class="ulist"><ul><li><p>Download jars from project website</p></li><li><p>Lived in a <code>lib</code> directory or equivalent</p></li><li><p>Often saved next to code in source control</p></li></ul></div></li></ul></div></section><section id="growing-ecosystem"><h2>Growing ecosystem</h2><div class="paragraph"><p>With the growing popularity of Java and the growth of its ecosystem,
managing all dependencies of a project turns into a dependency chase.</p></div></section><section id="thus-dependency-management"><h2>Thus dependency management &#8230;&#8203;</h2><div class="ulist"><ul><li><p>Ivy or Maven would take care of your dependencies</p><div class="ulist"><ul><li><p>Libraries have known coordinates</p></li><li><p>Published to repositories, with metadata in addition of the binary</p></li><li><p>Automated the transitive aspect of dependency management</p></li></ul></div></li></ul></div></section><section id="and-gradle-joins-the-party"><h2>And Gradle joins the party</h2><div class="ulist"><ul><li><p>Compatible with all of the previous options</p><div class="ulist"><ul><li><p><code>lib</code> or custom repositories</p></li><li><p>Ivy metadata</p></li><li><p>Maven metadata</p></li><li><p>Gradle Module Metadata (<a href="https://blog.gradle.org/gradle-metadata-1.0">since 5.3</a>)</p></li><li><p>and more &#8230;&#8203;</p></li></ul></div></li></ul></div></section></section>
<section><section id="dependency-handling-in-gradle" data-background-color="#01303a"><h2>Dependency handling in Gradle</h2><div class="paragraph"><p>Need a refresh?</p></div></section><section id="declaring-dependencies"><h2>Declaring dependencies</h2><div class="ulist"><ul><li><p>Repositories</p></li><li><p>Configurations</p></li><li><p>Dependencies</p></li></ul></div></section><section id="repositories"><h2>Repositories</h2><div class="ulist"><ul><li><p>Enables automated fetching of remote dependencies</p></li><li><p>Gradle attaches importance to the source of a dependency, its origin repository.</p></li><li><p>Declaration order matters</p></li><li><p>And <code>mavenLocal()</code>?</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>Talk about download, caching</p></li><li><p>checksums and refresh</p></li></ul></div></aside></section><section id="repository-content-filtering"><h2>Repository content filtering</h2><div class="paragraph"><p>New in Gradle 5.1:</p></div>
<pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">repositories {
    maven {
        url "https://repo.mycompany.com"
        content {
           includeGroupByRegex "com\\.mycompany.*"
        }
    }
}</code></pre></section><section id="configurations"><h2>Configurations</h2><div class="paragraph"><p>Three different kinds:</p></div>
<div class="ulist"><ul><li class="fragment"><p>Bucket of dependencies</p><div class="ulist"><ul><li><p><code>canBeResolved=false, canBeConsumed=false</code></p></li></ul></div></li><li class="fragment"><p>Resolvable configurations</p><div class="ulist"><ul><li><p><code>canBeResolved=true, canBeConsumed=false</code></p></li></ul></div></li><li class="fragment"><p>Consumable configurations</p><div class="ulist"><ul><li><p><code>canBeResolved=false, canBeConsumed=true</code></p></li></ul></div></li></ul></div></section><section id="dependencies"><h2>Dependencies</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">dependencies {
    implementation 'org.slf4j:slf4j-api:1.7.26'
}</code></pre>
<div class="paragraph"><p>You can also use rich version declarations:</p></div>
<pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">dependencies {
   implementation("info.picocli:picocli") {
       version {
          strictly("[3.9, 4.0[")
          prefer("3.9.5")
          reject("3.9.3")
       }
   }
}</code></pre></section><section id="semantics-and-dependencies"><h2>Semantics and dependencies</h2><div class="paragraph"><p>Gradle has a strong modelling of dependencies:</p></div>
<div class="ulist"><ul><li><p>Semantic difference between compilation and runtime</p></li><li><p>Semantic difference between building a library and building <em>against</em> a library</p></li><li><p>Ability for a module to produce more than one variant</p></li></ul></div></section></section>
<section><section id="inspecting-the-dependency-graph" data-background-color="#01303a"><h2>Inspecting the dependency graph</h2></section><section id="the-build-declaration"><h2>The build declaration</h2><div class="paragraph"><p>Example from Netflix: <a href="https://github.com/Netflix/genie" class="bare">https://github.com/Netflix/genie</a></p></div>
<pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">dependencies {
    implementation(project(":genie-security"))
    implementation(project(":genie-web"))
    implementation(project(":genie-ui"))

    testImplementation(project(":genie-test"))
    testImplementation(project(":genie-test-web"))
}</code></pre>
<div class="paragraph"><p>So which dependencies will be used then?</p></div>
<div class="paragraph"><p>For compilation? at runtime?</p></div></section><section id="demo" data-background-color="#01303a"><h2>Demo</h2><aside class="notes"><div class="ulist"><ul><li><p>compileClasspath vs runtimeClasspath</p></li><li><p>Structure of the tree</p></li><li><p>Version information</p></li><li><p>Notations for omitted and constraints</p></li></ul></div></aside></section><section id="code-dependencies-code-reporting-task"><h2><code>dependencies</code> reporting task</h2><div class="paragraph"><p><code>$ ./gradlew genie-app:dependencies --configuration compileClasspath</code></p></div>
<div class="ulist"><ul><li><p>Will resolve the configuration <code>compileClasspath</code></p></li><li><p>Will list all dependencies it contains as a tree</p><div class="ulist"><ul><li><p>First level dependencies at the root</p></li><li><p>then transitive dependencies</p></li></ul></div></li></ul></div></section><section id="dependencies-2"><div class="ulist"><ul><li><p>Provides information about the versions</p><div class="ulist"><ul><li><p>Requested version vs. resolved version</p></li></ul></div></li><li><p>Cuts repeating parts - see the <code>(*)</code></p></li><li><p>Indicates constraints - see the <code>(c)</code></p></li></ul></div></section><section id="code-dependencyinsight-code-reporting-task"><h2><code>dependencyInsight</code> reporting task</h2><div class="paragraph"><p><code>$ ./gradlew genie-app:dependencyInsight --configuration compileClasspath --dependency jsr305</code></p></div>
<div class="ulist"><ul><li><p>Will give detailed information on a dependency</p></li><li><p>What was selected?</p></li><li><p>What participated in the selection?</p></li></ul></div></section><section id="help-your-future-self"><h2>Help your future self!</h2><div class="paragraph"><p>A number of APIs around dependencies have a <code>because(String)</code> method.</p></div>
<div class="paragraph"><p>Use it and its output will be part of the dependency insight report.</p></div>
<pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">dependencies {
   implementation("info.picocli:picocli") {
       version {
          strictly("[3.9, 4.0[")
          prefer("3.9.5")
          reject("3.9.3")
       }
       because("Provides command-line argument parsing but not 3.9.3 that has a bug affecting our usage")
   }
}</code></pre></section><section id="really-do"><h2>Really do!</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">configurations.all {
    resolutionStrategy.eachDependency {
        if (requested.group == "org.gradle") {
            useVersion("1.4")
            because("API breakage in higher versions")
        }
    }
}</code></pre></section><section id="even-more-options-with-plugins"><h2>Even more options with plugins</h2><div class="ulist"><ul><li class="fragment"><p><a href="https://plugins.gradle.org/plugin/nebula.lint">Gradle Lint Plugin</a></p><div class="ulist"><ul><li><p>Unused dependencies</p></li><li><p>Dependency version bump</p></li></ul></div></li><li class="fragment"><p><a href="https://plugins.gradle.org/plugin/com.github.ben-manes.versions">Gradle Versions Plugin</a></p><div class="ulist"><ul><li><p>Reports on dependency versions used compared to available ones in repositories</p></li></ul></div></li><li class="fragment"><p>And more &#8230;&#8203;</p></li></ul></div></section></section>
<section><section id="bill-of-materials-support-in-gradle" data-background-color="#01303a"><h2>Bill Of Materials support in Gradle</h2></section><section id="what-is-a-maven-bom"><h2>What is a Maven BOM?</h2><div class="ulist"><ul><li><p>Defines versions (and more) for dependencies</p></li><li><p>Used for obtaining a consistent set of versions</p><div class="ulist"><ul><li><p>For modules composing a library, that work better together at the same version</p></li><li><p>For heterogeneous modules that form an ecosystem</p></li></ul></div></li><li><p>Allows to omit versions in the build file that imports it</p></li></ul></div>
<div class="paragraph"><p><a href="http://repo.maven.apache.org/maven2/org/springframework/boot/spring-boot-dependencies/2.1.6.RELEASE/spring-boot-dependencies-2.1.6.RELEASE.pom">Example</a></p></div></section><section id="importing-a-bom-in-gradle"><h2>Importing a BOM in Gradle</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">dependencies {
    implementation(
        platform(
            'org.springframework.boot:spring-boot-dependencies:2.1.6.RELEASE'
        )
    )
}</code></pre></section><section id="particularities-in-gradle"><h2>Particularities in Gradle</h2><div class="ulist"><ul><li><p>BOM dependency declarations are imported as <em>constraints</em></p></li><li><p>BOMs are like regular dependencies, they can be visible by consumers</p></li><li><p>Gradle <em>always</em> considers <em>all</em> versions in a dependency graph</p><div class="ulist"><ul><li><p>No shortest path wins</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>This creates an important difference with application of BOMs in Maven:</p></div>
<div class="paragraph"><p><em>In Gradle, the transitive dependency graph can still resolve a dependency with a different version than specified in the BOM.</em></p></div></section><section id="enforced-boms"><h2>Enforced BOMs</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">dependencies {
    implementation(
        enforcedPlatform(
            'org.springframework.boot:spring-boot-dependencies:2.1.6.RELEASE'
        )
    )
}</code></pre>
<div class="paragraph"><p>Will result in constraints that <em>force</em> versions instead of participating in version conflict resolution.</p></div>
<div class="paragraph"><p>Use responsibly, as again, this can be visible to your consumers.</p></div></section><section id="replacement-of-spring-dependency-management-plugin"><h2>Replacement of Spring dependency management plugin</h2><div class="ulist"><ul><li><p>For most use cases</p></li><li><p>Unsupported scenarios:</p><div class="ulist"><ul><li><p>If you want to override properties defined in the BOM to have a different set of constraints</p></li><li><p>Local dependency declaration causing a downgrade</p></li></ul></div></li></ul></div></section></section>
<section><section id="aligning-a-group-of-dependencies" data-background-color="#01303a"><h2>Aligning a group of dependencies</h2></section><section id="what-is-the-problem"><h2>What is the problem?</h2><div class="ulist"><ul><li><p>A group of dependencies are designed to work together.</p><div class="ulist"><ul><li><p>Think <code>jackson</code> or even the Spring framework</p></li></ul></div></li><li><p>Through transitive dependency updates, modules end up having different versions</p></li></ul></div>
<div class="paragraph"><p>So the goal would be to have the tools to make sure that <em>any</em> upgrade of <em>any</em> module would cause the whole set to upgrade its version.</p></div></section><section id="demo-2" data-background-color="#01303a"><h2>Demo</h2></section><section id="virtual-platforms-for-published-libraries"><h2>Virtual platforms for published libraries</h2><div class="ulist"><ul><li class="fragment"><p>Name a virtual platform module</p></li><li class="fragment"><p>Enhance library modules metadata to reference that platform</p></li><li class="fragment"><p>Each added module is also made part of the virtual platform</p><div class="ulist"><ul><li><p>When <code>jackson-dataformat-yaml</code> says it belongs to the platform, all platform <em>versions</em> now point to it as well</p></li></ul></div></li><li class="fragment"><p>Alignment!</p></li></ul></div></section><section id="details-details"><h2>Details, details</h2><div class="ulist"><ul><li class="fragment"><p>A virtual platform can only align to a version it sees in the graph</p></li><li class="fragment"><p>A virtual platform will <em>attempt</em> alignment on all modules</p><div class="ulist"><ul><li><p>I a module <code>X</code> does not exist in version <code>B</code>, lower known versions will be tried in decreasing order</p></li></ul></div></li></ul></div></section><section id="can-i-leverage-an-existing-bom"><h2>Can I leverage an existing BOM?</h2><div class="ulist"><ul><li class="fragment"><p>Yes, but:</p></li><li class="fragment"><p>You still need the <code>belongsTo</code></p></li><li class="fragment"><p>Alignment will be according to the BOM definitions</p></li></ul></div></section></section>
<section><section id="gradle-java-platforms" data-background-color="#01303a"><h2>Gradle Java platforms</h2></section><section id="the-code-java-platform-code-plugin"><h2>The <code>java-platform</code> plugin</h2><div class="paragraph"><p>A special kind of project, that contains no code but only defines constraints, and optionally dependencies.</p></div>
<div class="paragraph"><p>Allows you to model different things:</p></div>
<div class="ulist"><ul><li class="fragment"><p>Defines the versions of dependencies for your multi project build</p></li><li class="fragment"><p>Defines a set of dependencies that have been tested together and can be the base for others to develop on top</p></li><li class="fragment"><p>Defines the different modules that compose your published library</p></li></ul></div></section><section id="multi-project-platform-example"><h2>Multi project platform example</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">plugins {
  `java-platform`
}

dependencies {
    constraints {
        api("commons-httpclient:commons-httpclient:3.1")
        runtime("org.postgresql:postgresql:42.2.5")
    }
}</code></pre></section><section id="recommendation-platform-example"><h2>Recommendation platform example</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">plugins {
  `java-platform`
}

javaPlatform {
    allowDependencies()
}

dependencies {
  constraints {
      runtime('org.postgresql:postgresql:42.2.6')
  }
  api(platform('org.springframework.boot:spring-boot-dependencies:2.1.5.RELEASE'))
  api(platform('com.fasterxml.jackson:jackson-bom:2.8.9'))
}</code></pre></section><section id="alignment-platform"><h2>Alignment platform</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">plugins {
  `java-platform`
}

dependencies {
    constraints {
        api(project(':common'))
        api(project(':server'))
        api(project(':client'))
    }
}</code></pre>
<div class="paragraph"><p>In addition each of the modules uses the platform.</p></div></section><section id="but"><h2>But &#8230;&#8203;</h2><div class="ulist"><ul><li><p>To leverage all of this, Maven or Ivy metadata formats are not enough</p></li><li><p>Gradle has now its own metadata format</p><div class="ulist"><ul><li><p>Stable since Gradle 5.3</p></li><li><p>Turned on by default in (upcoming) Gradle 6.0</p></li></ul></div></li></ul></div>
<div class="paragraph"><p>Try it out with the following in your <code>settings.gradle</code>:</p></div>
<pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">enableFeaturePreview("GRADLE_METADATA")</code></pre></section></section>
<section><section id="module-capabilities" data-background-color="#01303a"><h2>Module capabilities</h2></section><section id="definition"><h2>Definition</h2><div class="ulist"><ul><li><p>Modules have different coordinates</p></li><li><p>However they sometimes conflict, replace each other, &#8230;&#8203;</p></li></ul></div>
<div class="paragraph"><p>What if there was something to express that?</p></div>
<div class="paragraph"><p>And your dependency management system could use that information?</p></div></section><section id="the-famous-logging-problem"><h2>The famous logging problem</h2><div class="ulist"><ul><li class="fragment"><p>Slf4j and is bridging / replacement modules</p></li><li class="fragment"><p><code>log4j</code> vs. <code>slf4j-log4j12</code> vs. <code>log4j-over-slf4j</code></p></li><li class="fragment"><p>And similarly for <code>java.util.logging</code></p></li><li class="fragment"><p>And again for <code>commons-logging</code></p></li></ul></div></section><section id="the-renamed-or-variant-of-libraries"><h2>The renamed or variant of libraries</h2><div class="ulist"><ul><li class="fragment"><p><code>asm:asm</code> now known as <code>org.ow2.asm:asm</code></p></li><li class="fragment"><p><code>junit:junit-dep</code> and <code>junit:junit</code></p></li><li class="fragment"><p><code>cglib:cglib-nodep</code> and <code>cglib:cglib</code></p></li></ul></div></section><section id="enter-capabilities"><h2>Enter capabilities</h2><div class="ulist"><ul><li><p>Expressed as a GAV - yes, versioned!</p></li><li><p>By default, all modules have a capability that matches their coordinates</p></li><li><p>It is illegal to have two modules providing the same capability in a dependency graph</p></li></ul></div></section><section id="how-to-use-them"><h2>How to use them?</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">dependencies {
  components.withModule('org.slf4j:log4j-over-slf4j', Log4JOverSlf4JRule)
}

class Log4JOverSlf4JRule implements ComponentMetadataRule {
  @Override
  void execute(ComponentMetadataContext context) {
    def details = context.details
    def version = details.id.version
    details.allVariants { variant -&gt;
      variant.withCapabilities { capabilities -&gt;
        capabilities.addCapability("org.apache.logging.log4j", "log4j", "1.2.18")
        capabilities.addCapability("org.slf4j", "slf4j-log4j12", version)
      }
    }
  }
}</code></pre></section><section id="limitations"><h2>Limitations</h2><div class="ulist"><ul><li class="fragment"><p>Does not get triggered if there is no conflict</p></li><li class="fragment"><p>Currently only a detection mechanism</p></li><li class="fragment"><p>Unless the engine can <em>upgrade</em> the version of the capability</p></li><li class="fragment"><p>Future work to ease expressing a preference</p><div class="ulist"><ul><li><p>For this capability, my graph should use that module</p></li></ul></div></li></ul></div></section></section>
<section><section id="dependency-locking-usage-pattern" data-background-color="#01303a"><h2>Dependency locking usage pattern</h2></section><section id="the-scenario"><h2>The scenario</h2><div class="ulist"><ul><li class="fragment"><p>Organization with multiple repositories</p></li><li class="fragment"><p>Applications are built using internal libraries or frameworks</p></li><li class="fragment"><p>Keeping up to date with the internal releases is done:</p><div class="ulist"><ul><li><p>Through <code>-SNAPSHOT</code> dependencies, with all the potential instability</p></li><li><p>Manually, with edits of versions following releases</p></li></ul></div></li><li class="fragment"><p>Could it be better?</p></li></ul></div></section><section id="locking-refresher"><h2>Locking refresher</h2><div class="ulist"><ul><li><p>Usage of dynamic versions make builds non reproducible</p></li><li><p>Dependency locking freezes these dynamic versions, giving back reproducibility</p></li><li><p>Generates one file per locked configuration that contains the module GAV</p></li></ul></div></section><section id="enabling-locking"><h2>Enabling locking</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">configurations {
  compileClasspath {
    resolutionStrategy.activateDependencyLocking()
  }
}</code></pre></section><section id="generating-locking-state"><h2>Generating locking state</h2><pre class="highlight listingblock"><code data-noescape="" class="shell language-shell">$ ./gradlew compileJava --write-locks</code></pre>
<div class="ulist"><ul><li><p>Through the task execution, a number of configurations are resolved</p></li><li><p>All the configurations that have locking activated <em>and</em> are resolved will write their lock state</p></li></ul></div></section><section id="leveraging-lock-state"><h2>Leveraging lock state</h2><pre class="highlight listingblock"><code data-noescape="" class="shell language-shell">$ ./gradlew compileJava</code></pre>
<div class="ulist"><ul><li><p>All resolved configurations that have existing lock state <em>and</em> are resolved will load it and apply it</p></li><li><p>Build fails if dependencies have been added, removed or changed version</p></li></ul></div></section><section id="updating-lock-state"><h2>Updating lock state</h2><pre class="highlight listingblock"><code data-noescape="" class="shell language-shell">$ ./gradlew compileJava --update-locks my.company:*</code></pre>
<div class="ulist"><ul><li><p>Lock state for matching modules is ignored</p></li><li><p>Remaining lock state is applied in a lenient way, to allow cascading updates</p><div class="ulist"><ul><li><p>Updating <code>my.company:utils</code> may cause an update of <code>com.google.guava:guava</code></p></li></ul></div></li></ul></div></section><section id="how-does-it-help-then"><h2>How does it help then?</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">dependencies {
  implementation 'my.company:utils:[1.0,2.0['
}</code></pre>
<div class="ulist"><ul><li><p>Instead of using <code>-SNAPSHOT</code> or fixed version, use ranges</p></li><li><p>Since your organisation controls the versioning, you should be able to rely on semantic versioning</p></li></ul></div></section><section id="demo-3" data-background-color="#01303a"><h2>Demo</h2></section><section id="and-publishing"><h2>And publishing?</h2><div class="ulist"><ul><li class="fragment"><p>If the common components use a similar system, then publishing is an issue</p><div class="ulist"><ul><li><p>By default, Gradle publishes the <em>declared</em> versions</p></li><li><p>Declaring ranges makes <em>your consumers</em> non reproducible</p></li></ul></div></li><li class="fragment"><p>Leverage the publication of <em>resolved</em> versions</p><div class="ulist"><ul><li><p><code>versionMapping</code> to the rescue</p></li></ul></div></li></ul></div></section><section id="code-versionmapping-code-in-detail"><h2><code>versionMapping</code> in detail</h2><pre class="highlight listingblock"><code data-noescape="" class="groovy language-groovy">publishing {
    publications {
        mavenJava(MavenPublication) {
            versionMapping {
                usage('java-api') {
                    fromResolutionOf('runtimeClasspath')
                }
                usage('java-runtime') {
                    fromResolutionResult()
                }
            }
        }
    }
}</code></pre></section></section>
<section><section id="conclusion" data-background-color="#01303a"><h2>Conclusion</h2></section><section id="discover-and-experiment"><h2>Discover and experiment</h2><div class="ulist"><ul><li class="fragment"><p>Gradle has a rich set of dependency management features</p><div class="ulist"><ul><li><p>Capabilities, selection rules, &#8230;&#8203;</p></li></ul></div></li><li class="fragment"><p>Using them all is not a goal,</p></li><li class="fragment"><p>But sometimes a necessity to accommodate the reality out there</p></li></ul></div></section></section>
<section id="thank-you" data-background-image="./images/thank-you.png" data-background-size="cover"></section></div></div><script src="reveal.js/lib/js/head.min.js"></script><script src="reveal.js/js/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
})

// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: 'true',
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'linear',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
      { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
      { src: 'reveal.js/plugin/notes/notes.js', async: true },
      
      
      
      
  ],

  

});</script><!-- this currently shows up at the wrong location in the final index.html which means the style font is not properly applied-->

<div class="footer">
    <p>#voxxed_lu #gdm5 @ljacomet</p><img class="conf" src="./images/voxxed_lu.png" />
</div></body></html>